let gateway=`ws://${window.location.hostname}/ws`;let websocket;let robotStatus={type:"status",lightState:false,beepState:false,lmotor_power:0,rmotor_power:0,uds_distance:0};let powerInc=2.5;let trimInc=.025;let turnSpdPercentage=.7;let defaultPower=160;let defaultTrim=0;let powerTrimChangeInterval;let powerTrimChangeTimeout;function initWebSocket(){websocket=new WebSocket(gateway);websocket.onopen=onOpen;websocket.onclose=onClose;websocket.onmessage=onMessage}function onOpen(e){requestStatus()}function requestStatus(){jsondata={type:"status"};websocket.send(jsondata);updateStatusIndicators()}function onClose(e){setTimeout(initWebSocket,2e3)}function onMessage(e){robotStatus=JSON.parse(e.data);updateSensorReadings()}function updateStatusIndicators(){let e=$("#lights");let t=$("#beep");if(robotStatus.beepState){t.addClass("onbutton");t.removeClass("offbutton")}else{t.addClass("offbutton");t.removeClass("onbutton")}if(robotStatus.lightState){e.addClass("onbutton");e.removeClass("offbutton")}else{e.addClass("offbutton");e.removeClass("onbutton")}}function updateSensorReadings(){let e=parseFloat(robotStatus.uds_distance);$("#UDS1_display").text(e)}$(document).ready(function(){getPowerValue();getTrimValue();updateStatusIndicators();if(isTouchEnabled()){for(element of $("input, button")){element.onmousedown="";element.onmouseup=""}}else{for(element of $("input, button")){element.ontouchstart="";element.ontouchend=""}}initWebSocket();setInterval(requestStatus,200)});function move(e,t){e.preventDefault();let o=getPowerValue();let a=getTrimValue();let r={type:"motors",lmotor_power:0,rmotor_power:0};switch(t){case"forward":r.lmotor_power=o*(1+a);r.rmotor_power=o*(1-a);$("#forward").addClass("pressedbutton");break;case"backward":r.lmotor_power=-o*(1+a);r.rmotor_power=-o*(1-a);$("#backward").addClass("pressedbutton");break;case"left":r.lmotor_power=-turnSpdPercentage*o*(1+a);r.rmotor_power=turnSpdPercentage*o*(1-a);$("#left").addClass("pressedbutton");break;case"right":r.lmotor_power=turnSpdPercentage*o*(1+a);r.rmotor_power=-turnSpdPercentage*o*(1-a);$("#right").addClass("pressedbutton");break;case"brake":r.lmotor_power=-999;r.rmotor_power=-999;$("#brake").addClass("pressedbutton");break;case"stop":default:$(".dpad_button").removeClass("pressedbutton");break}websocket.send(JSON.stringify(r))}function setPower(e){$("#power").val(e);$("#power_display").text($("#power").val())}function setTrim(e){$("#trim").val(e);$("#trim_display").text($("#trim").val())}function changePower(e){power=getPowerValue();power+=e;power=Math.min(power,255);power=Math.max(power,0);setPower(power)}function changeTrim(e){trim=getTrimValue();trim+=e;trim=Math.min(trim,1);trim=Math.max(trim,-1);setTrim(trim)}function getPowerValue(){let e=$("#power").val();e=parseInt(e);let t=$("#power_display");$("#power_display").text(e);return e}function getTrimValue(){let e=$("#trim").val();e=parseFloat(e);let t=$("#trim_display");$("#trim_display").text(e);return e}function holdPowerTrimButtons(e,t,o){e.preventDefault();switch(t){case"power":powerTrimChangeTimeout=setTimeout(function(){powerTrimChangeInterval=setInterval(changePower,50,o)},500);break;case"trim":powerTrimChangeTimeout=setTimeout(function(){powerTrimChangeInterval=setInterval(changeTrim,50,o)},500);break;default:}}function releasePowerTrimButtons(e){e.preventDefault();clearTimeout(powerTrimChangeTimeout);clearInterval(powerTrimChangeInterval)}function keyupHandler(e){let t=e.key;switch(t){case"h":case"H":toggleBeep(e,"off");break;case"w":case"W":case"a":case"A":case"s":case"S":case"d":case"D":case" ":move(e,"")}}function keydownHandler(e){let t=e.key;switch(t){case"w":case"W":move(e,"forward");break;case"a":case"A":move(e,"left");break;case"s":case"S":move(e,"backward");break;case"d":case"D":move(e,"right");break;case"-":changePower(-powerInc);break;case"=":changePower(powerInc);break;case"[":changeTrim(-trimInc);break;case"]":changeTrim(trimInc);break;case"l":case"L":toggleLights(e,"toggle");break;case"h":case"H":toggleBeep(e,"on");break;case" ":move(e,"brake");break;case"r":case"R":setPower(defaultPower);break;case"t":case"T":setTrim(defaultTrim);break;default:break}}function toggleLights(e,t){e.preventDefault();let o=false;switch(t){case"on":o=true;break;case"toggle":o=!robotStatus.lightState;break;default:break}let a={type:"lights",lights_state:o};websocket.send(JSON.stringify(a));updateStatusIndicators()}function toggleBeep(e,t){e.preventDefault();let o=false;switch(t){case"on":o=true;break;default:break}let a={type:"beep",horn_state:o};websocket.send(JSON.stringify(a));updateStatusIndicators()}function isTouchEnabled(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}function isTouchInsideElement(e,t){const o=t.getBoundingClientRect();return e.touches[0].clientX>=o.left&&e.touches[0].clientX<=o.right&&e.touches[0].clientY>=o.top&&e.touches[0].clientY<=o.bottom}