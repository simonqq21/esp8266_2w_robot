let gateway=`ws://${window.location.hostname}/ws`,websocket,robotStatus={type:"status",lightState:!1,beepState:!1,lmotor_power:0,rmotor_power:0},powerInc=2.5,trimInc=.025,turnSpdPercentage=.8,powerTrimChangeInterval,powerTrimChangeTimeout;function initWebSocket(){(websocket=new WebSocket(gateway)).onopen=onOpen,websocket.onclose=onClose,websocket.onmessage=onMessage}function onOpen(e){requestStatus()}function requestStatus(){jsondata={command:"update"},websocket.send(jsondata),updateStatusIndicators()}function onClose(e){setTimeout(initWebSocket,2e3)}function onMessage(e){console.log(e.data),robotStatus=JSON.parse(e.data)}function updateStatusIndicators(){var e=$("#lights"),t=$("#beep");robotStatus.beepState?(t.addClass("onbutton"),t.removeClass("offbutton")):(t.addClass("offbutton"),t.removeClass("onbutton")),robotStatus.lightState?(e.addClass("onbutton"),e.removeClass("offbutton")):(e.addClass("offbutton"),e.removeClass("onbutton"))}function move(e,t){e.preventDefault();var o=getPowerValue(),r=getTrimValue(),n={type:"motors",lmotor_power:0,rmotor_power:0};switch(t){case"forward":console.log("trim = ",r),n.lmotor_power=o*(1+r),n.rmotor_power=o*(1-r),$("#forward").addClass("pressedbutton"),console.log("forward");break;case"backward":n.lmotor_power=-o*(1+r),n.rmotor_power=-o*(1-r),$("#backward").addClass("pressedbutton"),console.log("backward");break;case"left":n.lmotor_power=-turnSpdPercentage*o*(1+r),n.rmotor_power=turnSpdPercentage*o*(1-r),$("#left").addClass("pressedbutton"),console.log("left");break;case"right":n.lmotor_power=turnSpdPercentage*o*(1+r),n.rmotor_power=-turnSpdPercentage*o*(1-r),$("#right").addClass("pressedbutton"),console.log("right");break;case"brake":n.lmotor_power=-999,n.rmotor_power=-999,$("#brake").addClass("pressedbutton"),console.log("brake");break;default:$(".dpad_button").removeClass("pressedbutton"),console.log("stop")}console.log("motor json = ",JSON.stringify(n)),websocket.send(JSON.stringify(n))}function setPower(e){$("#power").val(e),$("#power_display").text($("#power").val()),console.log("power=",e)}function setTrim(e){$("#trim").val(e),$("#trim_display").text($("#trim").val()),console.log("trim=",e)}function changePower(e){power=getPowerValue(),power+=e,power=Math.min(power,255),setPower(power=Math.max(power,0))}function changeTrim(e){trim=getTrimValue(),trim+=e,trim=Math.min(trim,1),setTrim(trim=Math.max(trim,-1))}function getPowerValue(){var e=$("#power").val(),e=parseInt(e);$("#power_display");return $("#power_display").text(e),e}function getTrimValue(){var e=$("#trim").val(),e=parseFloat(e);$("#trim_display");return $("#trim_display").text(e),e}function holdPowerTrimButtons(e,t,o){switch(e.preventDefault(),t){case"power":powerTrimChangeTimeout=setTimeout(function(){powerTrimChangeInterval=setInterval(changePower,50,o)},500);break;case"trim":powerTrimChangeTimeout=setTimeout(function(){powerTrimChangeInterval=setInterval(changeTrim,50,o)},500)}}function releasePowerTrimButtons(e){e.preventDefault(),clearTimeout(powerTrimChangeTimeout),clearInterval(powerTrimChangeInterval)}function keyupHandler(e){switch(e.key){case"h":case"H":toggleBeep("off");break;default:move(e,"")}}function keydownHandler(e){switch(e.key){case"w":case"W":console.log("forward"),move(e,"forward");break;case"a":case"A":console.log("left"),move(e,"left");break;case"s":case"S":console.log("backward"),move(e,"backward");break;case"d":case"D":console.log("right"),move(e,"right");break;case"-":console.log("power -"),changePower(-powerInc);break;case"=":console.log("power +"),changePower(powerInc);break;case"[":console.log("trim -"),changeTrim(-trimInc);break;case"]":console.log("trim +"),changeTrim(trimInc);break;case"l":case"L":console.log("lights toggle"),toggleLights(e,"toggle");break;case"h":case"H":console.log("horn press"),toggleBeep(e,"on");break;case" ":move(e,"brake")}}function toggleLights(e,t){e.preventDefault();let o=!1;switch(t){case"on":o=!0;break;case"toggle":o=!robotStatus.lightState}e={type:"lights",lights_state:o};websocket.send(JSON.stringify(e)),updateStatusIndicators()}function toggleBeep(e,t){e.preventDefault();let o=!1;e={type:"beep",horn_state:o="on"===t?!0:o};websocket.send(JSON.stringify(e)),updateStatusIndicators()}function isTouchEnabled(){return"ontouchstart"in window||0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints}function isTouchInsideElement(e,t){t=t.getBoundingClientRect();return e.touches[0].clientX>=t.left&&e.touches[0].clientX<=t.right&&e.touches[0].clientY>=t.top&&e.touches[0].clientY<=t.bottom}function stopOnTouchLeave(e){isTouchInsideElement(e,e.target)||move(e,"")}function stopHornOnTouchLeave(e){isTouchInsideElement(e,e.target)||toggleBeep(e,"off")}$(document).ready(function(){if(getPowerValue(),getTrimValue(),updateStatusIndicators(),isTouchEnabled())for(element of $("input, button"))element.onmousedown="",element.onmouseup="";else for(element of $("input, button"))element.ontouchstart="",element.ontouchend="";initWebSocket(),setInterval(requestStatus,200)});