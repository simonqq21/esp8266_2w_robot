<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width initial-scale=1.0">
    <title></title>
    <style>
        * {
            font-family: Arial, serif;
        }

        #movementControls, #toggleControls {
            display: block;
            text-align: center;
        }

        #dpad_grid_container {
            display: inline-block;
        }

        #dpad_grid {
            display: grid;
            grid-template-columns: auto auto auto;
            align-items: center;
        }

        div {
            margin: 0.5vw;
        }

        .dpad_spacer {
            height: 6vw;
            width: 6vw;
            margin: 0;
        }

        .dpad_button {
            background-color: green;
            padding: 0;
        }

        .dpad_image {
            height: 6vw;
            width: 6vw;
            padding: 0;
        }

        #lights_icon, #beep_icon {
            height: 2vw;
            width: 2vw;
            padding: 0;
        }

        input[type=range] {
            display: inline-block;
            width: 40vw;
            accent-color: green;
        }

        /* #speed::-moz-range-thumb {  
            border-radius: 50%;
            height: 1.5vw;
            width: 1.5vw;
        }
       
        #speed::-moz-range-track {
            height: 0.5vw;
        }  */

        input[type=checkbox] {
            width: 2vw;
            height: 2vw;
            accent-color: green;
        }

        #toggleControls > div {
            display: inline;
        }
    </style>
    <script src="jquery_min.js"></script>
</head>  
<body>
    <div>
        <header>
            <h1>ESP8266 WiFi robot</h1>
        </header>
    </div>
    <div id="controls">
        <div id="movementControls">
            <div id="dpad_grid_container">
                <div id="dpad_grid">
                    <div class="dpad_spacer"></div>
                    <button id="forward" name="forward" class="dpad_button"><img src="forward.svg" alt="forward" class="dpad_image"
                        onmousedown="move('forward')"
                        onmouseup=""
                        ontouchstart=""
                        ontouchend=""
                    ></button>
                    <div class="dpad_spacer"></div>
                    <button id="left" name="left" class="dpad_button"><img src="left.svg" alt="left" class="dpad_image"
                        onmousedown="move('forward')"
                        onmouseup=""
                        ontouchstart=""
                        ontouchend=""
                    ></button>
                    <div class="dpad_spacer"></div>
                    <button id="right" name="right" class="dpad_button"><img src="right.svg" alt="right" class="dpad_image"
                        onmousedown="move('forward')"
                        onmouseup=""
                        ontouchstart=""
                        ontouchend=""
                    ></button>
                    <div class="dpad_spacer"></div>
                    <button id="backward" name="backward" class="dpad_button"><img src="backward.svg" alt="backward" class="dpad_image"
                        onmousedown="move('forward')"
                        onmouseup=""
                        ontouchstart=""
                        ontouchend=""
                    ></button>
                    <div class="dpad_spacer"></div>
                </div>
            </div>
            <div id="speedControl">
                <label for="speed" style="margin: 0 1.5vw 0;">Speed adjustment:  </label>
                <input type="range" id="speed" name="speed" class="range1" 
                    oninput=""
                ></input>
            </div>
            <div id="trimControl">
                <label for="trim" style="margin: 0 1.5vw 0;">Trim adjustment:  </label>
                <input type="range" id="trim" name="trim" class="range1"
                    oninput=""
                ></input>
            </div>

        </div>
        
        <div id="toggleControls">
            <div id="lightControl">
                <button id="lights" name="lights" value="lights"
                    oninput=""
                ><img src="lights.svg" id="lights_icon" alt="Lights"></button>
                <label for="lights">Lights</label>
            </div>
            <div if="beepControl">
                <button id="beep" name="beep" value="beep"
                    oninput=""
                ><img src="horn.svg" id="beep_icon" alt="Beep"></button>
                <label for="beep">Beep</label>
            </div>
        </div> 
        <div id="instructions">
            <h2>Instructions</h2>
            <p>Move the joystick with your mouse or finger to move the robot.</p>
            <p>On a desktop browser, the WASD keys can be used to move the robot 
                and the - and + keys can be used to adjust the speed.</p>
            <p>The readout below the joystick displays the distance measured by the ultrasonic sensor.</p>
            <p>The toggle controls below control the lights and the buzzer horn.</p>    
        </div>
    </div>
           
</body>
<script type="text/javascript">
    let gateway = `ws://${window.location.hostname}/ws`;
    let websocket; 

    function initWebSocket() {
        // alert('Websocket initializing');
        websocket = new WebSocket(gateway);
        websocket.onopen = onOpen; 
        websocket.onclose = onClose; 
        websocket.onmessage = onMessage;
    }
    // runs when websocket opens
    function onOpen(event) {
        // alert('Connection opened');
        websocket.send("new");
    }

    // runs when websocket closes
    function onClose(event) {
        // alert('Connection closed');
        setTimeout(initWebSocket, 2000); // restart websocket
    }

    // runs when websocket receives message from server
    function onMessage(event) {
        let jsondata = JSON.parse(event.data);
        let type = jsondata.type;
        if (type == 'led') {
            updateLEDStatus(jsondata);
        }
        else if (type == 'button') {
            updateBtnStatus(jsondata);
        }
    } 

        /*
    speed slider value = speed, from 0 to 255 
    trim slider value = trim, from -127 to 127 
    
    */ 

    $(document).ready(function() {

    });

    function initBody() {
        if (isTouchEnabled()) {
            for (element of document.getElementsByTagName("*")) {
                element.onmousedown = ""; 
                element.onmouseup = "";
            }    
        }
        else {
            for (element of document.getElementsByTagName("*")) {
                element.ontouchstart = ""; 
                element.ontouchend = "";
            } 
        }
        initWebSocket();
    }

    function isTouchEnabled() {
        return ('ontouchstart' in window) || 
            (navigator.maxTouchPoints > 0) || 
            (navigator.msMaxTouchPoints > 0);
    }
</script>
</html>